{% extends "base.html" %}
{% load staticfiles %}
{% load materializecss %}

{% block page_title %}Statistics{% endblock %}

{% block styles %}
<style>
    body {
        background: url("{% static 'img/purple-bg.jpg' %}") no-repeat center center fixed;
        background-size: cover;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">

        <div class="row">
            <div class="col s12 m8 offset-m2 l6 offset-l3">
                <h1 id="h1-large" class="center-align font-baloo white-text card-border text-shadow">
                    Statistics
                </h1>
            </div>
        </div>

    <div class="row">
        <!-- bugs vs features -->
        <div class="col s12 l6">
            <div class="card-border">
                <div class="card">
                    <canvas id="bugsVsFeatures" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- ticket status -->
        <div class="col s12 l6">
            <div class="card-border">
                <div class="card">
                    <canvas id="status" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- update frequency -->
        <div class="col s12 l6">
            <div class="card-border">
                <div class="card">
                    <canvas id="updatedTickets" height="200"></canvas>
                </div>
            </div>
        </div>

    </div>

</div>
{% endblock %}


{% block page_js %}
<script>
    var bugs_count = {{ bugs_count|safe }};
    var features_count = {{ features_count|safe }};

    Chart.defaults.global.defaultFontColor = "#4a148c";
    Chart.defaults.global.defaultFontSize = 18;


    new Chart(document.getElementById('bugsVsFeatures'), {
        type: 'pie',
        data: {
            labels: ['Bug Reports', 'Feature Requests'],
            datasets: [{
                label: 'Bugs vs Features',
                data: [bugs_count, features_count],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.25)',
                    'rgba(54, 162, 235, 0.25)'
                ],
                hoverBackgroundColor: [
                    'rgba(255, 99, 132, 0.5)',
                    'rgba(54, 162, 235, 0.5)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)'
                ],
                borderWidth: 1
            }]
        }
    });

    var todo_count = {{ todo_count|safe }};
    var in_progress_count = {{ in_progress_count|safe }};
    var completed_count = {{ completed_count|safe }};

    new Chart(document.getElementById('status'), {
        type: 'pie',
        data: {
            labels: ['To-Do', 'In Progress', 'Completed'],
            datasets: [{
                label: 'Ticket Status',
                data: [todo_count, in_progress_count, completed_count],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.25)',
                    'rgba(54, 162, 235, 0.25)',
                    'rgba(255, 206, 86, 0.25)'
                ],
                hoverBackgroundColor: [
                    'rgba(255, 99, 132, 0.5)',
                    'rgba(54, 162, 235, 0.5)',
                    'rgba(255, 206, 86, 0.5)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)'
                ],
                borderWidth: 1
            }]
        }
    });

    var daily_updated = {{ daily_updated|safe }};
    var weekly_updated = {{ weekly_updated|safe }};
    var updated_tickets = {{ updated_tickets|safe }};

    new Chart(document.getElementById('updatedTickets'), {
        type: 'bar',
        data: {
            labels: ['Daily', 'Weekly', 'Monthly'],
            datasets: [{
                label: 'Update Frequency',
                data: [daily_updated, weekly_updated, updated_tickets],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.25)',
                    'rgba(54, 162, 235, 0.25)',
                    'rgba(255, 206, 86, 0.25)'
                ],
                hoverBackgroundColor: [
                    'rgba(255, 99, 132, 0.5)',
                    'rgba(54, 162, 235, 0.5)',
                    'rgba(255, 206, 86, 0.5)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

</script>

{% endblock %}